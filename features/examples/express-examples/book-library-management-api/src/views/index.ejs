<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Home</title>
    <link rel="stylesheet" href="/css/app.css" />
  </head>
  <body>
    <div class="page">
      <%- include('partials/header', { activePage: 'home' }) %>
      <header>
        <h1>Explore the Book Library</h1>
        <p>
          Discover new titles, revisit timeless classics, and download digital
          copies from our growing collection curated for curious minds.
        </p>
      </header>

      <div class="layout">
        <div class="main-column">
          <% if (books && books.length > 0) { %>
          <div class="books-grid">
            <% books.forEach(function (book) { %>
            <article class="book-card">
              <div class="book-cover">
                <% if (book.coverImage) { %>
                <a href="/book/<%= book._id %>">
                  <img
                    src="<%= book.coverImage %>"
                    alt="Cover of <%= book.title %>"
                    loading="lazy"
                  />
                </a>
                <% } else { %>
                <div class="placeholder">Cover coming soon</div>
                <% } %>
              </div>
              <div class="book-content">
                <h2>
                  <a
                    href="/book/<%= book._id %>"
                    style="text-decoration: none; color: inherit"
                    ><%= book.title %></a
                  >
                </h2>
                <div class="book-meta">
                  <span>By <strong><%= book.author %></strong></span>
                  <span>Published <%= book.publishedLabel %></span>
                  <span>Genre: <%= book.genre || "General" %></span>
                </div>
                <p class="book-description"><%= book.description %></p>
                <div class="book-footer">
                  <span class="rating-badge">
                    <svg
                      width="14"
                      height="14"
                      viewBox="0 0 24 24"
                      fill="currentColor"
                      focusable="false"
                      aria-hidden="true"
                      style="margin-right: 6px"
                    >
                      <path
                        d="M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.62L12 2 9.19 8.62 2 9.24l5.46 4.73L5.82 21z"
                      />
                    </svg>
                    <%= book.averageRating.toFixed(1) %>/5
                  </span>
                  <span
                    ><%= book.reviewCount %> review<%= book.reviewCount === 1 ?
                    "" : "s" %></span
                  >
                </div>
                <div class="book-links">
                  <% if (book.pdfUrl) { %>
                  <a href="<%= book.pdfUrl %>" target="_blank" rel="noopener">
                    Read PDF
                  </a>
                  <% } %> <% if (book.buyHardCopyFrom) { %>
                  <a
                    href="<%= book.buyHardCopyFrom %>"
                    target="_blank"
                    rel="noopener"
                  >
                    Buy Hard Copy
                  </a>
                  <% } %>
                </div>
              </div>
            </article>
            <% }); %>
          </div>
          <% if (pagination && pagination.totalPages > 1) { %>
          <div class="pagination">
            <% const currentPage = pagination.page; const totalPages =
            pagination.totalPages; const prevDisabled = !pagination.hasPrevPage
            ? "disabled" : ""; const nextDisabled = !pagination.hasNextPage ?
            "disabled" : ""; const windowSize = 5; const half =
            Math.floor(windowSize / 2); let start = Math.max(1, currentPage -
            half); let end = Math.min(totalPages, start + windowSize - 1); if
            (end - start + 1 < windowSize) { start = Math.max(1, end -
            windowSize + 1); } %>
            <a
              class="<%= prevDisabled %>"
              href="/?page=<%= pagination.prevPage || 1 %>"
              >Prev</a
            >
            <% if (start > 1) { %>
            <a href="/?page=1">1</a>
            <% if (start > 2) { %><span>…</span><% } %> <% } %> <% for (let p =
            start; p <= end; p++) { %> <% if (p === currentPage) { %>
            <span class="active"><%= p %></span>
            <% } else { %>
            <a href="/?page=<%= p %>"><%= p %></a>
            <% } %> <% } %> <% if (end < totalPages) { %> <% if (end <
            totalPages - 1) { %><span>…</span><% } %>
            <a href="/?page=<%= totalPages %>"><%= totalPages %></a>
            <% } %>
            <a
              class="<%= nextDisabled %>"
              href="/?page=<%= pagination.nextPage || totalPages %>"
              >Next</a
            >
          </div>
          <% } %> <% } else { %>
          <div class="empty-state">
            No books available yet. Check back soon or ask an administrator to
            seed the library.
          </div>
          <% } %>
        </div>
        <aside class="sidebar">
          <div class="sidebar-card">
            <h3>Popular Authors</h3>
            <% if (popularAuthors && popularAuthors.length > 0) { %>
            <div class="author-list">
              <% popularAuthors.forEach(function (author) { %>
              <div class="author-item">
                <span class="author-name"><%= author.name %></span>
                <span class="author-count"><%= author.bookCount %> books</span>
              </div>
              <% }); %>
            </div>
            <% } else { %>
            <p class="muted">
              No author data yet. Add more books to build trends.
            </p>
            <% } %>
          </div>
        </aside>
      </div>
    </div>
    <script src="/js/theme.js" defer></script>
  </body>
</html>
